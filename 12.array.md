# Chapter 12: Mảng (Arrays)

## 12.1. Gán mảng

Mảng trong bash

    array=('first element' 'second element' 'third element')

Ví dụ:

    [root@localhost ~]# array=(1 2 3 4)
    [root@localhost ~]# echo ${array[0]}
    1
    [root@localhost ~]# echo ${array[*]}
    1 2 3 4
    [root@localhost ~]# array1=("khong" "mot" "hai" "ba")
    [root@localhost ~]# echo ${array1[*]}
    khong mot hai ba
    [root@localhost ~]# echo ${array1[0]}
    khong
    [root@localhost ~]# echo ${array1[3]}
    ba
    [root@localhost ~]# echo ${array1[-2]}
    hai
    [root@localhost ~]# echo ${array1[-3]}
    mot
    [root@localhost ~]#
Trong dấu ngoặc vuông là thứ tự của phần trong mảng.
- *: Lấy ra tất cả các phần tử trong mảng
- Số nguyên dương là từ trái qua phải. Bắt đầu bằng 0 là phần tử đầu tiên
- Số nguyên âm là lấy từ phải qua trải bắt đầu bằng -1

### Chỉ định bảng phụ

Tạo mảng với các chỉ số phần tử rõ ràng:

    [root@localhost ~]# array=([3]='fourth element' [4]='fifth element')
    [root@localhost ~]# echo ${array[3]}
    fourth element
    [root@localhost ~]# echo ${array[4]}
    fifth element
    [root@localhost ~]#

Lưu ý: Khi khai báo như trên thì các phần tử cũ sẽ bị xóa. Và khi gọi phải đúng tên số đã khai báo

### Tạo mảng theo chỉ mục

Khai báo các thành phần trong mảng

    [root@localhost ~]#array[0]='first element'
    [root@localhost ~]#array[1]='second element'
    [root@localhost ~]# echo ${array[*]}
    first element second element 

### Tạo mảng theo tên

    [root@localhost ~]# declare -A array2
    [root@localhost ~]# array2[first]='First element'
    [root@localhost ~]# array2[second]='Second element'

### Tạo mảng động

Tạo một mảng từ output của lệnh khác. Ví dụ dùng seq để lấy một khoảng từ 1 đến 10:

    [root@localhost ~]# array=(`seq 1 10`)
    [root@localhost ~]# echo ${array[*]}
    1 2 3 4 5 6 7 8 9 10

Gán mảng với vòng lặp

    while read -r; do
    #array+=("$REPLY") # Array append
    array[$i]="$REPLY" # Assignment by index
    let i++ # Increment index
    done < <(seq 1 10) # command substitution
    echo ${array[@]} # output: 1 2 3 4 5 6 7 8 9 10

## 12.2. Truy cập các phần tử mảng

Khai báo mảng và phần tử trong mảng:

    arr=(`seq 1 10`)

In phần tử ở index 0

    [root@localhost ~]# echo "${arr[0]}"
    1

In phần tử cuối cùng bằng cú pháp mở rộng chuỗi con

    [root@localhost ~]# echo "${arr[@]: -1 }"
    10

In phần tử cuối cùng bằng cú pháp chỉ số con

    [root@localhost ~]# echo "${arr[-1]}"
    10

In tất cả các phần tử, mỗi phần tử được trích dẫn riêng biệt

    [root@localhost ~]# echo "${arr[@]}"
    1 2 3 4 5 6 7 8 9 10

In tất cả các phần tử dưới dạng một chuỗi được trích dẫn duy nhất

    [root@localhost ~]# echo "${arr[*]}"
    1 2 3 4 5 6 7 8 9 10

In tất cả các phần tử từ chỉ mục 1, mỗi phần tử được trích dẫn riêng biệt

    [root@localhost ~]# echo "${array[@]:1}"
    2 3 4 5 6 7 8 9 10

In 3 phần tử từ chỉ mục 1, mỗi phần tử được trích dẫn riêng biệt

    [root@localhost ~]# echo "${array[@]:1:3}"
    2 3 4

### Hoạt động với chuỗi

    array=(zero one two)

Lấy ra phần tử đầu tiên, trong đó 0 khởi đầu và lấy 3 ký tự trong phần tử để in ra

    [root@localhost ~]# echo "${array[0]:0:3}"
    zer

Lấy ra phần tử thứ 2, và bắt đầu lấy từ vị trí thứ 1 và lấy 2 ký tự.

    [root@localhost ~]# echo "${array[1]:1:2}"
    ne

Vậy `${array[$i]:N:M}` cho ra một chuỗi từ vị trí thứ N (bắt đầu từ 0) trong chuỗi `${array[$ i]}` với M ký tự sau.

## 12.3. Chỉnh sửa chuỗi

### Sửa index

Khởi tạo hoặc cập nhật một phần tử cụ thể trong mảng

    [root@localhost ~]# array[10]="elevenths element"
    [root@localhost ~]# echo "${array[*]}"
    zero one two elevenths element

Vì mảng trước đó đã khai là `array=(zero one two)` chỉ có các phần tử 0, 1, 2. Khi khai thêm phần tử 10, nó sẽ tự động được đặt ở vị trí cuối cùng trong mảng vì không có các phần tử 3, 4, 5, ..., 9

### Nối

Sửa đổi mảng, thêm phần tử vào cuối nếu không có chỉ số con nào được chỉ định.

    [root@localhost ~]# array+=('new1' 'new2')
    [root@localhost ~]# echo "${array[*]}"
    zero one two elevenths element new1 new2

Hoặc

    array=("${array[@]}" "new1" "new2")

### Chèn một phần tử lên đầu mảng

    [root@localhost ~]# array=("new With Begin" "${array[@]}")
    [root@localhost ~]# echo "${array[*]}"
    new With Begin zero one two elevenths element new1 new2

### Chèn một phần tử vào vị trí xác định

    [root@localhost ~]# arr=(a b c d)
    [root@localhost ~]# arr=("${arr[@]:0:2}" 'new' "${arr[@]:2}")
    [root@localhost ~]# echo "${arr[*]}"
    a b new c d
    [root@localhost ~]#

### Xóa phần tử chỉ định

    [root@localhost ~]# arr=(a b c)
    [root@localhost ~]# echo "${arr[@]}"
    a b c
    [root@localhost ~]# echo "${!arr[@]}"
    0 1 2
    [root@localhost ~]# unset -v 'arr[1]'
    [root@localhost ~]# echo "${arr[@]}"
    a c
    [root@localhost ~]# echo "${!arr[@]}"
    0 2
    [root@localhost ~]#

### Hợp nhất mảng

Cú pháp:

    array3=("${array1[@]}" "${array2[@]}")

Ví dụ: 

    [root@localhost ~]# array3=("${arr[@]}" "${array[@]}")
    [root@localhost ~]# echo "${array3[@]}"
    a c new With Begin zero one two elevenths element new1 new2

### Reindex một mảng

Điều này có thể hữu ích nếu các phần tử đã bị xóa khỏi một mảng hoặc nếu bạn không chắc liệu có khoảng trống trong mảng hay không. Để tạo lại các chỉ số mà không có khoảng trống:

    array=("${array[@]}")

## 12.4. Lặp lại mảng

Có 2 loại là vòng lặp foreach và vòng lặp for:

foreach loop

    a=(1 2 3 4)
    for y in "${a[@]}"; do
    # act on $y
    echo "$y"
    done

for loop

    for ((idx=0; idx < ${#a[@]}; ++idx)); do
    # act on ${a[$idx]}
    echo "${a[$idx]}"
    done

Có thể lặp lại output của lệnh:

    a=($(tr ',' ' ' <<<"a,b,c,d"))
    for y in "${a[@]}"; do
    echo "$y"
    done

## 12.5. Độ dài mảng

`${#array[@]}` cho ra độ dài của mảng `${array[@]}`:

    [root@localhost ~]# array=('first element' 'second element' 'third element')
    [root@localhost ~]# echo "${#array[@]}"
    3

Có thể xem cả độ dài của phần tử. Ví dụ xem độ dài của phần tử 0 (first element) trong mảng array

    [root@localhost ~]# echo "${#array[0]}"
    13

## 12.6. Mảng liên kết

Khai báo mảng liên kết

    declare -A aa

    aa[hello]=world
    aa[ab]=cd
    aa["key with space"]="hello world"

Hoặc

    aa=([hello]=world [ab]=cd ["key with space"]="hello world")

Truy cập phần tử của mảng liên kết

    [root@localhost ~]# echo ${aa[hello]}
    world

Lấy ra tất cả các key của mảng liên kết

    [root@localhost ~]# echo "${!aa[@]}"
    ab key with space hello

Liệt kê các giá trị mảng liên kết

    [root@localhost ~]#echo "${aa[@]}"
    world cd hello world

Đếm các phần tử của mảng liên kết

    [root@localhost ~]# echo "${#aa[@]}"
    3

## 12.7. Lặp thông qua mảng

Mảng ví dụ:

    [root@localhost ~]# arr=(a b c d e f)

Dùng vòng lặp for ... in

    [root@localhost ~]# for i in "${arr[@]}"; do
    > echo "$i"
    > done
    a
    b
    c
    d
    e
    f

Dùng vòng lặp kiểu C

    [root@localhost ~]# for ((i=0;i<${#arr[@]};i++)); do
    > echo "${arr[$i]}"
    > done
    a
    b
    c
    d
    e
    f

Dùng vòng lặp while

    [root@localhost ~]# i=0
    [root@localhost ~]# while [ $i -lt ${#arr[@]} ]; do
    > echo "${arr[$i]}"
    > i=$((i + 1))
    > done
    a
    b
    c
    d
    e
    f

Dùng vòng lặp while với điều kiện số

    [root@localhost ~]# i=0
    [root@localhost ~]# while (( $i < ${#arr[@]} )); do
    > echo "${arr[$i]}"
    > ((i++))
    > done
    a
    b
    c
    d
    e
    f

Dùng vòng lặp until

    [root@localhost ~]# i=0
    [root@localhost ~]# until [ $i -ge ${#arr[@]} ]; do
    > echo "${arr[$i]}"
    > i=$((i + 1))
    > done
    a
    b
    c
    d
    e
    f

Dùng vòng lặp until với điều kiện số

    [root@localhost ~]# i=0
    [root@localhost ~]# until (( $i >= ${#arr[@]} )); do
    > echo "${arr[$i]}"
    > ((i++))
    > done
    a
    b
    c
    d
    e
    f

## 12.8. Xóa mảng

    unset array

Xóa phần tử chỉ định

    unset array[10]

## 12.9. Mảng từ chuỗi

    stringVar="Apple Orange Banana Mango"
    arrayVar=(${stringVar// / })

Mỗi dấu cách trong chuỗi biểu thị một mục mới trong mảng kết quả.

    [root@localhost ~]# echo ${arrayVar[0]} 
    Apple
    [root@localhost ~]# echo ${arrayVar[3]} 
    Mango
    [root@localhost ~]#

## 12.10. Liệt kê các chỉ mục được khởi tạo

Liệt kê ra các vị trí phần tử đã được khai báo nội dung

    [root@localhost ~]# arr[2]='second'
    [root@localhost ~]# arr[10]='tenth'
    [root@localhost ~]#  arr[25]='twenty five'
    [root@localhost ~]# echo ${!arr[@]}
    2 10 25
    [root@localhost ~]#

## 12.11. Đọc một file vào mảng

Thêm nội dung file "file" vào mảng "arr"

    IFS=$'\n' read -r -a arr < file

Dùng vòng lặp

    arr=()
    while IFS= read -r line; do
    arr+=("$line")
    done

Nhập và các phần tử và ngăn cách bằng cách xuống dòng. Kết thúc nhập bằng Ctrl + Z

Dùng mapfile hoặc readarray:

    mapfile -t arr < file
    readarray -t arr < file


