# Chapter 22: Biểu thức có điều kiện

## 22.1. test loại file

Option `-e` test file có tồn tại hay không

    [root@localhost ~]# cat file.sh
    #!/bin/bash
    echo "nhap ten file?"
    read filename

    if [[ -e $filename ]]; then
    echo "$filename exists"
    else
    echo "file does not exist"
    fi
    [root@localhost ~]# ./file.sh
    nhap ten file?
    file1
    file1 exists
    [root@localhost ~]# ./file.sh
    nhap ten file?
    file1231231
    file does not exist
    [root@localhost ~]#

test loại file

    [root@localhost ~]# cat file1.sh
    #!/bin/bash
    echo "nhap ten file?"
    read filename

    if [[ -f $filename ]]; then
    echo "$filename is a regular file"
    elif [[ -d $filename ]]; then
    echo "$filename is a directory"
    elif [[ -p $filename ]]; then
    echo "$filename is a named pipe"
    elif [[ -S $filename ]]; then
    echo "$filename is a named socket"
    elif [[ -b $filename ]]; then
    echo "$filename is a block device"
    elif [[ -c $filename ]]; then
    echo "$filename is a character device"
    fi
    if [[ -L $filename ]]; then
    echo "$filename is a symbolic link (to any file type)"
    fi
    [root@localhost ~]# ./file1.sh
    nhap ten file?
    file1
    file1 is a regular file
    [root@localhost ~]# ./file1.sh
    nhap ten file?
    myPipe
    myPipe is a named pipe
    [root@localhost ~]#

## 22.2. So sánh và đối sánh chuỗi

So sánh chuỗi sử dụng toán tử `==` giữa các chuỗi được trích dẫn. Toán tử `!=` phủ định phép so sánh.

    [root@localhost ~]# cat file2.sh
    #!/bin/bash
    echo "Nhap chuoi 1:"
    read string1
    echo "Nhap chuoi 2:"
    read string2

    if [[ "$string1" == "$string2" ]]; then
    echo "\$string1 and \$string2 are identical"
    fi
    if [[ "$string1" != "$string2" ]]; then
    echo "\$string1 and \$string2 are not identical"
    fi
    [root@localhost ~]# ./file2.sh
    Nhap chuoi 1:
    123
    Nhap chuoi 2:
    123
    $string1 and $string2 are identical
    [root@localhost ~]# ./file2.sh
    Nhap chuoi 1:
    123
    Nhap chuoi 2:
    abc
    $string1 and $string2 are not identical

Nếu vế phải không phải là trích dẫn, thì nó là wildcard pattern được đói xứng với $string

    string='abc'
    pattern1='a*'
    pattern2='x*'
    if [[ "$string" == $pattern1 ]]; then
    # the test is true
    echo "The string $string matches the pattern $pattern"
    fi
    if [[ "$string" != $pattern2 ]]; then
    # the test is false
    echo "The string $string does not match the pattern $pattern"
    fi

Các toán tử `<` và `>` so sánh các chuỗi theo thứ tự từ vựng (không có toán tử nào nhỏ hơn hoặc bằng hoặc lớn hơn hoặc bằng cho các chuỗi).

Có các bài test một lần cho chuỗi trống.

    [root@localhost ~]# cat file4.sh
    #!/bin/bash
    echo "Nhap chuoi:"
    read string
    if [[ -n "$string" ]]; then
    echo "$string is non-empty"
    fi
    if [[ -z "${string// }" ]]; then
    echo "$string is empty or contains only spaces"
    fi
    if [[ -z "$string" ]]; then
    echo "$string is empty"
    fi
    [root@localhost ~]#
    [root@localhost ~]# ./file4.sh
    Nhap chuoi:
    123
    123 is non-empty
    [root@localhost ~]# ./file4.sh
    Nhap chuoi:

    is empty or contains only spaces
    is empty
    [root@localhost ~]#

## 22.3. test trạng thái exit của lệnh

Trạng thái exit 0: thành công

Trạng thái exit khác 0: thất bại

Để thực hiện:

    if command;then
        echo 'success'
    else
        echo 'failure'
    fi

## 22.4. test One liner

Ta có thể thực hiện những thứ như sau:

    [[ $s = 'something' ]] && echo 'matched' || echo "didn't match"
    [[ $s == 'something' ]] && echo 'matched' || echo "didn't match"
    [[ $s != 'something' ]] && echo "didn't match" || echo "matched"
    [[ $s -eq 10 ]] && echo 'equal' || echo "not equal"
    (( $s == 10 )) && echo 'equal' || echo 'not equal'

test trạng thái exit

    command && echo 'exited with 0' || echo 'non 0 exit'
    cmd && cmd1 && echo 'previous cmds were successful' || echo 'one of them failed'
    cmd || cmd1   #If cmd fails try cmd1

## 22.5. So sánh file

    if [[ $file1 -ef $file2 ]]; then
        echo "$file1 and $file2 are the same file"
    fi

“Tệp giống nhau” có nghĩa là việc sửa đổi một trong các tệp tại chỗ sẽ ảnh hưởng đến tệp còn lại. Hai tệp có thể giống nhau ngay cả khi chúng có tên khác nhau, chẳng hạn nếu chúng là liên kết cứng hoặc nếu chúng là liên kết tượng trưng với cùng một mục tiêu hoặc nếu một là một liên kết tượng trưng trỏ đến tệp kia.

Nếu hai tệp có cùng nội dung, nhưng chúng là các tệp riêng biệt (để việc sửa đổi một tệp không ảnh hưởng đến tệp kia), thì -ef báo cáo chúng là khác nhau. Nếu bạn muốn so sánh hai tệp từng byte, hãy sử dụng tiện ích cmp.

    if cmp -s -- "$file1" "$file2"; then
        echo "$file1 and $file2 have identical contents"
    else
        echo "$file1 and $file2 differ"
    fi

Output

    [root@localhost opt]# ./file.sh
    Nhap ten file1:
    file3.gz
    Nhap ten file2:
    file3.gz
    file3.gz and file3.gz have identical contents
    [root@localhost opt]# ./file.sh
    Nhap ten file1:
    howdy.txt.gz
    Nhap ten file2:
    log.txt
    Binary files howdy.txt.gz and log.txt differ


Để tạo ra một danh sách có thể đọc được của con người về sự khác biệt giữa các tệp văn bản, hãy sử dụng tiện ích khác biệt.

    if diff -u "$file1" "$file2"; then
    echo "$file1 and $file2 have identical contents"
    else
    : # the differences between the files have been listed
    fi

Output

    [root@localhost opt]# ./file.sh
    Nhap ten file1:
    log.txt
    Nhap ten file2:
    bar.txt
    --- log.txt     2021-09-13 11:24:27.504000000 +0700
    +++ bar.txt     2021-09-15 08:57:42.379000000 +0700
    @@ -0,0 +1 @@
    +foo


## 22.6. test truy cập file

    if [[ -r $filename ]]; then
    echo "$filename is a readable file"
    fi
    if [[ -w $filename ]]; then
    echo "$filename is a writable file"
    fi
    if [[ -x $filename ]]; then
    echo "$filename is an executable file"
    fi

Output:

    [root@localhost opt]# ./file123.sh
    nhap ten file:
    log.txt
    log.txt is a readable file
    log.txt is a writable file
    [root@localhost opt]#

## 22.7. So sánh số học

    if [[ $num1 -eq $num2 ]]; then
    echo "$num1 == $num2"
    fi
    if [[ $num1 -le $num2 ]]; then
    echo "$num1 <= $num2"
    fi

Output

    [root@localhost opt]# ./file12.sh
    Nhap so 1:
    123
    Nhap so 2:
    312
    123 <= 312
 
Lưu ý rằng các toán tử `<` và `>` bên trong `[[…]]` so sánh các chuỗi, không phải số

    if [[ 9 -lt 10 ]]; then
    echo "9 is before 10 in numeric order"
    fi
    if [[ 9 > 10 ]]; then
    echo "9 is after 10 in lexicographic order"
    fi

Hai vế phải là số được viết dưới dạng thập phân (hoặc ở dạng bát phân với số 0 đứng đầu). Ngoài ra, sử dụng cú pháp biểu thức số học ((…)), thực hiện các phép tính số nguyên trong cú pháp giống C / Java /….

    x=2
    if ((2*x == 4)); then
    echo "2 times 2 is 4"
    fi
    ((x += 1))
    echo "2 plus 1 is $x"