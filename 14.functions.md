# Chapter 14: Hàm (Functions)

## 14.1. Các hàm có đối số

Nội dung file script `hello.sh`

    greet() {
        echo "Hello, $1"
    }
    greet "$1"

    [root@localhost ~]# ./hello.sh VN
    Hello, VN

Với nhiều đối số

    In() {
    echo First Name: "$1"
    echo Last Name: "$2"
    }
    In "$@"

    [root@localhost ~]# ./hello.sh Dung Doan
    First Name: Dung
    Last Name: Doan

Lưu ý: Cách viết `$n` thì n không được lớn hơn 9 đối số. `$10` sẽ không hoạt động mà cần phải viết như sau: `${10}`

## 14.2. Hàm đơn giản

    greet() {
        echo "Hello, Dung"
    }
    greet

    [root@localhost ~]# ./hello.sh
    Hello World!

Sử dụng source có thể làm hàm có sẵn trong phiên bash hiện tại

    [root@localhost ~]# source hello.sh
    Hello World!
    [root@localhost ~]# greet
    Hello World!
    [root@localhost ~]#

Có thể export hàm trong shell.

    [root@localhost ~]# bash -c 'greet'
    bash: greet: command not found
    [root@localhost ~]# export -f greet
    [root@localhost ~]# bash -c 'greet'
    Hello World!
    [root@localhost ~]#

## 14.4. In định nghĩa hàm

    callfunc() {
        declare -f "$@"
    }
    function func(){
        echo "Đây là một function"
    }
    funcd="$(callfunc func)"
    callfunc func # hoặc  echo "$funcd"

Output:

    [root@localhost ~]# ./fun.sh
    func ()
    {
        echo "Đây là một function"
    }

## 14.5. Một hàm chấp nhận các tham số được đặt tên

    foo() {
        while [[ "$#" -gt 0 ]]
        do
            case $1 in
                -f|--follow)
                    local FOLLOW="following"
                    ;;
                -t|--tail)
                    local TAIL="tail=$2"
                    ;;
            esac
            shift
        done

    echo "FOLLOW: $FOLLOW"
    echo "TAIL: $TAIL"
    }

Ví dụ sử dụng

    [root@localhost ~]# foo -f
    FOLLOW: following
    TAIL:
    [root@localhost ~]# foo -t 10
    FOLLOW:
    TAIL: tail=10
    [root@localhost ~]# foo -f --tail 10
    FOLLOW: following
    TAIL: tail=10
    [root@localhost ~]# foo --follow --tail 10
    FOLLOW: following
    TAIL: tail=10
    [root@localhost ~]#

## 14.6. Trả lại giá trị từ hàm

Câu lệnh return trong bash là thoát khỏi hàm với một giá trị return trả về. Có thể coi đó là một trạng thái thoát của function

Nếu bạn muốn trả về một giá trị từ function thì hãy gửi giá trị đến stdout như sau:

    fun() {
    local var="Sample value to be returned"
    echo "$var"
    #printf "%s\n" "$var"
    }

    [root@localhost ~]# ./fun.sh
    [root@localhost ~]# fun
    Sample value to be returned
    [root@localhost ~]#

## 14.7. exit code cả một hàm là exit code của lệnh gần nhất

    is_alive() { ping -c1 “$1” }

Hàm này sẽ gửi một lệnh ping đến một máy chủ được chỉ định bởi tham số đầu tiên. STDOUT và STDERR của lệnh ping đều được gửi đên /dev/null, vì vậy hàn sẽ không bao giờ xuất ra bất kỳ thứ gì. Nhưng lệnh ping sẽ có exit code bằng 0 khi thành công và khác 0 khi thất bại vì đây là lệnh thoát cuối cùng của hàm, exit code của ping sẽ được sử dụng lại cho exit code của hàm chính.