## Chapter 15: Mở rộng tham số bash

## 15.1. Viết hoa hoặc không viết hoa các chữ cái

### Viết hoa

    [root@localhost ~]# v="hello"

Viết hoa chữ đầu tiên

    [root@localhost ~]# printf '%s\n' "${v^}"
    Hello

Viết hoa toàn bộ

    [root@localhost ~]# printf '%s\n' "${v^^}"
    HELLO

Hoặc

    [root@localhost ~]# v="hello world"
    [root@localhost ~]# declare -u string="$v"
    [root@localhost ~]# echo "$string"
    HELLO WORLD
    [root@localhost ~]#

### Viết thường

    [root@localhost ~]# v="BYE"

Chỉ chữ cái đầu tiên

    [root@localhost ~]# printf '%s\n' "${v,}"
    bYE

Toàn bộ

    [root@localhost ~]#  printf '%s\n' "${v,,}"
    bye

Hoặc

    [root@localhost ~]# v="HELLO WORLD"
    [root@localhost ~]# declare -l string="$v"
    [root@localhost ~]# echo "$string"
    hello world
    [root@localhost ~]#

### Chuyển đổi trạng thái ký tự

    [root@localhost ~]# v="Hello World"

Thay đổi toàn bộ

    [root@localhost ~]# echo "${v~~}"
    hELLO wORLD

Chỉ chữ cái đầu tiên

    [root@localhost ~]# echo "${v~}"
    hello world
    [root@localhost ~]#

## 15.2. Độ dài của tham số



    [root@localhost ~]# var='12345'
    [root@localhost ~]# echo "${#var}"
    5

    [root@localhost ~]# myarr=(1 22 3333 4444)
    [root@localhost ~]# echo "${#myarr[@]}"
    4

    [root@localhost ~]# set -- 1a 2 3 4123c 524ad 6czx
    [root@localhost ~]# echo "${#@}"
    6

## 15.3. Thay thế trong chuỗi

    [root@localhost ~]# a='I am a string'
    [root@localhost ~]# echo "${a/a/A}"
    I Am a string
    [root@localhost ~]#

echo "${str/a/A}": phân tích trong ${str/a/A}

- str tên chuỗi
- a chữ cần thay
- A thay đổi chữ a đầu tiên thành A. 

Muốn thay đổi tất cả chữ a thành A thì dùng:

    [root@localhost ~]# echo "${a//a/A}"
    I Am A string

Thay đổi ký tự đầu tiên

    [root@localhost ~]# echo "${a/#I/y}"
    y am a string

Thay đổi ký tự cuối cùng

    [root@localhost ~]# echo "${a/%g/N}"
    I am a strinN

Thay đổi ký tự bằng ký tự trống

    [root@localhost ~]# echo "${a/%g/ }"
    I am a strin

Thêm tiền tố vào các mục mảng:

    [root@localhost ~]# A=(hello world)
    [root@localhost ~]# echo "${A[@]/#/R}"
    Rhello Rworld
    [root@localhost ~]#

## 15.4. Substrings và subarrays

    var='0123456789abcdef'

${var:n} Lấy từ vị trí số n đến hết

    [root@localhost ~]# printf '%s\n' "${var:3}"
    3456789abcdef

${var:n:y} Lấy từ vị trí n, lấy ra y ký tự.

    [root@localhost ~]# printf '%s\n' "${var:3:4}"
    3456

${var:n:-y} Số lượng độ dài âm tính từ cuối chuỗi. Lấy từ vị trí n và bỏ lại y ký tự

    [root@localhost ~]# printf '%s\n' "${var:3:-5}"
    3456789a

${var: -n} : Lấy số ký tự tính từ cuối. Cần dấu cách. Khác với ${var:-n}, tương tự ${var:(-n)}

    [root@localhost ~]# printf '%s\n' "${var: -6}"
    abcdef
    [root@localhost ~]# printf '%s\n' "${var:(-6)}"
    abcdef

${var:-n:-y} Số lượng độ dài âm tính từ cuối chuỗi. Lấy từ vị trí -n và bỏ lại y ký tự

    [root@localhost ~]# printf '%s\n' "${var: -6:-5}"
    a

Đối với mảng cũng tương tự

    [root@localhost ~]# myarr[0]='0123456789abcdef'
    [root@localhost ~]# printf '%s\n' "${myarr[0]:7:3}"
    789

Mở rộng tương tự áp dụng cho các tham số vị trí, trong đó hiệu số (offset) là một dựa trên:

    # Set các tham số vị trí $1, $2, ...
    set -- 1 2 3 4 5 6 7 8 9 0 a b c d e f

Lấy từ vị trí 10. Lưu ý rằng không có tham số $0

    [root@localhost ~]# printf '%s\n' "${@:10}"
    0
    a
    b
    c
    d
    e
    f

Lấy từ vị trí 10, độ dài là 3

    [root@localhost ~]# printf '%s\n' "${@:10:3}"
    0
    a
    b

Không lấy được độ dài âm với các tham số vị trí

    [root@localhost ~]# printf '%s\n' "${@:10:-2}"
    -bash: -2: substring expression < 0

Lấy từ vị trí -10, độ dài 2. Lưu ý cần có dấu cách

    [root@localhost ~]# printf '%s\n' "${@: -10:2}"
    7
    8

Mở rộng substring có thể dùng với mảng được lập chỉ mục (indexed arrays)

    myarr=(0 1 2 3 4 5 6 7 8 9 a b c d e f)

Các phần tử có chỉ số 5 trở lên

    [root@localhost ~]# printf '%s\n' "${myarr[@]:12}"
    c
    d
    e
    f

3 phần tử, bắt đầu bằng chỉ số 5

    [root@localhost ~]# printf '%s\n' "${myarr[@]:5:3}"
    5
    6
    7

Phần tử cuối cùng của mảng

    [root@localhost ~]# printf '%s\n' "${myarr[@]: -1}"
    f

## 15.5. Xóa một mẫu khỏi đầu của chuỗi

Xóa từ chữ a đầu tiên đổ về trước

    [root@localhost ~]# a='I am a string'
    [root@localhost ~]# echo "${a#*a}"
    m a string
    [root@localhost ~]#

Xóa từ chữ a cuối cùng đổ về trước

    [root@localhost ~]# echo "${a##*a}"
    string

## 15.6. Chuyển hướng tham số

Chuyển hướng bash cho phép nhận giá trị của một biến có tên được chứa trong một biến khác. 

Ví dụ:

    [root@localhost ~]# red="the color red"
    [root@localhost ~]# green="the color green"
    [root@localhost ~]# color=red
    [root@localhost ~]# echo "${!color}"
    the color red
    [root@localhost ~]# color=green
    [root@localhost ~]# echo "${!color}"
    the color green
    [root@localhost ~]#

Ví dụ khác

    [root@localhost ~]# foo=10
    [root@localhost ~]# x=foo

In ra biến

    [root@localhost ~]# echo ${x} 
    foo

Chuyển hướng mở rộng

    [root@localhost ~]# echo ${!x} 
    10
    [root@localhost ~]#

Ví dụ khác:

    [root@localhost ~]# argtester () { for (( i=1; i<="$#"; i++ )); do echo "${i}";done; }; argtester -ab -cd -ef
    1   # i được mở rộng đến 1
    2   # i được mở rộng đến 2
    3   # i được mở rộng đến 3

    [root@localhost ~]# argtester () { for (( i=1; i<="$#"; i++ )); do echo "${!i}";done; }; argtester -ab -cd -ef
    -ab     # i=1 -> được mở rộng đến $1 -> được mở rộng thành đối số đầu tiên được gửi đến hàm
    -cd     # i=2 -> được mở rộng đến $2 -> được mở rộng thành đối số đầu tiên được gửi đến hàm
    -ef     # i=3 -> được mở rộng đến $3 -> được mở rộng thành đối số đầu tiên được gửi đến hàm

## 15.7. Mở rộng tham số và các tên file

Bạn có thể sử dụng mở rộng tham số bash để mô phỏng các hoạt động xử lý tên tệp phổ biến như basename và dirname

Ví dụ:

FILENAME="/tmp/example/myfile.txt"

Để mô phỏng tên dirname và trả về tên thư mục của đường dẫn tệp:

    [root@localhost ~]# echo "${FILENAME%/*}"
    /tmp/example

Để mô phỏng basename $ FILENAME và trả về tên tệp của đường dẫn tệp:

    [root@localhost ~]# echo "${FILENAME##*/}"
    myfile.txt

Để mô phỏng basename $FILENAME .txt và trả về tên tệp không có tên mở rộng .txt:

    [root@localhost ~]# BASENAME="${FILENAME##*/}"
    [root@localhost ~]# echo "${BASENAME%%.txt}"
    myfile

## 15.8. Thay thế giá trị mặc định

${parameter:-word}: Nếu tham số không được đặt hoặc null, sự mở rộng của word sẽ được thay thế. Nếu không, giá trị của tham số được thay thế.

    [root@localhost ~]# unset var
    [root@localhost ~]# echo "${var:-XX}"   # Tham số chưa được đặt -> Xảy ra mở rộng
    XX
    [root@localhost ~]# var=""      # Tham số là null -> Xảy ra mở rộng
    [root@localhost ~]# echo "${var:-XX}"
    XX
    [root@localhost ~]# var=23      # Tham số không phải null -> kết quả ban đầu
    [root@localhost ~]# echo "${var:-XX}"
    23
    [root@localhost ~]#

## 15.9. Xóa mẫu từ cuối chuỗi


    [root@localhost ~]# a='I am a string'

Xóa từ chữ a cuối cùng trở về sau

    [root@localhost ~]# echo "${a%a*}"
    I am

Xóa từ chữ a đầu tiên trở về sau

    [root@localhost ~]# echo "${a%%a*}"
    I
    [root@localhost ~]#

